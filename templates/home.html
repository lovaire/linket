{% extends 'base.html' %}

{% block title %}Linket - Marketplace Link Afiliasi{% endblock %}

{% block content %}
    <h2 style="color: var(--dark-blue-1); font-weight: 800; font-size: 2rem; margin-bottom: 2rem;">
        Produk Terbaru
    </h2>
    
    <form method="GET" action="{% url 'home' %}" class="search-filter-form">
        <input type="text" name="q" value="{{ search_query }}" placeholder="Cari produk...">
        
        <select name="category">
            <option value="all" {% if selected_category == 'all' %}selected{% endif %}>Semua Kategori</option>
            {% for value, display in categories %}
                <option value="{{ value }}" {% if selected_category == value %}selected{% endif %}>
                    {{ display }}
                </option>
            {% endfor %}
        </select>

        <select name="marketplace">
            <option value="all" {% if selected_marketplace == 'all' %}selected{% endif %}>Semua Marketplace</option>
            {% for value, display in marketplaces %}
                <option value="{{ value }}" {% if selected_marketplace == value %}selected{% endif %}>
                    {{ display }}
                </option>
            {% endfor %}
        </select>
        
        <button type="submit" class="btn">Cari</button>
    </form>
    
    <div class="product-grid">
        {% for product in products %}
            <div class="product-card">
                
                <a href="{% url 'product_detail' pk=product.pk %}" class="product-card-img-link">
                    <img src="{{ product.get_cover_image }}" alt="{{ product.name }}" class="product-card-img">
                </a>
                
                <div class="product-card-content">
                    
                    <a href="{% url 'product_detail' pk=product.pk %}" style="text-decoration: none; color: inherit;">
                        <h3 class="product-card-name">{{ product.name }}</h3>
                    </a>
                    
                    <div class="product-card-price">Rp {{ product.price|floatformat:0 }}</div>
                    
                    <div class="product-card-rating">
                        ‚≠ê {{ product.rating }}/5.0
                    </div>
                    
                    <div class="product-card-info">
                        üè¨ {{ product.store_name|default:'Nama Toko' }}
                    </div>

                    <div class="product-card-info">
                        üõçÔ∏è {{ product.get_marketplace_display }}
                    </div>
                    
                    <div class="product-card-info" style="margin-bottom: 1rem;">
                        üë§ {{ product.affiliator.display_name|default:product.affiliator.username }}
                    </div>
                    
                    <a href="{% url 'product_detail' pk=product.pk %}" class="btn" style="margin-top: auto;">
                        Lihat Detail
                    </a>
                </div>
            </div>
        {% empty %}
            {% if search_query or selected_category != 'all' %}
                <p style="grid-column: 1 / -1; text-align: center;">
                    Produk tidak ditemukan. Coba ganti kata kunci atau kategori.
                </p>
            {% else %}
                <p style="grid-column: 1 / -1; text-align: center;">
                    Belum ada produk yang ditambahkan. Jadilah yang pertama menambahkan!
                </p>
            {% endif %}
            
        {% endfor %}
    </div>
{% endblock %}